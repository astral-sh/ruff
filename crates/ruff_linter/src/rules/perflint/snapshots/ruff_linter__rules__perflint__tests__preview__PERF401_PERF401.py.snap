---
source: crates/ruff_linter/src/rules/perflint/mod.rs
---
PERF401.py:6:13: PERF401 [*] Use a list comprehension to create a transformed list
  |
4 |     for i in items:
5 |         if i % 2:
6 |             result.append(i)  # PERF401
  |             ^^^^^^^^^^^^^^^^ PERF401
  |
  = help: Replace for loop with list comprehension

ℹ Unsafe fix
1 1 | def f():
2 2 |     items = [1, 2, 3, 4]
3   |-    result = []
4   |-    for i in items:
5   |-        if i % 2:
6   |-            result.append(i)  # PERF401
  3 |+    result = [i for i in items if i % 2]  # PERF401
7 4 | 
8 5 | 
9 6 | def f():

PERF401.py:13:9: PERF401 [*] Use a list comprehension to create a transformed list
   |
11 |     result = []
12 |     for i in items:
13 |         result.append(i * i)  # PERF401
   |         ^^^^^^^^^^^^^^^^^^^^ PERF401
   |
   = help: Replace for loop with list comprehension

ℹ Unsafe fix
8  8  | 
9  9  | def f():
10 10 |     items = [1, 2, 3, 4]
11    |-    result = []
12    |-    for i in items:
13    |-        result.append(i * i)  # PERF401
   11 |+    result = [i * i for i in items]  # PERF401
14 12 | 
15 13 | 
16 14 | def f():

PERF401.py:82:13: PERF401 [*] Use an async list comprehension to create a transformed list
   |
80 |     async for i in items:
81 |         if i % 2:
82 |             result.append(i)  # PERF401
   |             ^^^^^^^^^^^^^^^^ PERF401
   |
   = help: Replace for loop with list comprehension

ℹ Unsafe fix
76 76 | 
77 77 | async def f():
78 78 |     items = [1, 2, 3, 4]
79    |-    result = []
80    |-    async for i in items:
81    |-        if i % 2:
82    |-            result.append(i)  # PERF401
   79 |+    result = [i async for i in items if i % 2]  # PERF401
83 80 | 
84 81 | 
85 82 | async def f():

PERF401.py:89:9: PERF401 [*] Use an async list comprehension to create a transformed list
   |
87 |     result = []
88 |     async for i in items:
89 |         result.append(i)  # PERF401
   |         ^^^^^^^^^^^^^^^^ PERF401
   |
   = help: Replace for loop with list comprehension

ℹ Unsafe fix
84 84 | 
85 85 | async def f():
86 86 |     items = [1, 2, 3, 4]
87    |-    result = []
88    |-    async for i in items:
89    |-        result.append(i)  # PERF401
   87 |+    result = [i async for i in items]  # PERF401
90 88 | 
91 89 | 
92 90 | async def f():

PERF401.py:96:9: PERF401 [*] Use `list.extend` with an async comprehension to create a transformed list
   |
94 |     result = [1, 2]
95 |     async for i in items:
96 |         result.append(i)  # PERF401
   |         ^^^^^^^^^^^^^^^^ PERF401
   |
   = help: Replace for loop with list.extend

ℹ Unsafe fix
92 92 | async def f():
93 93 |     items = [1, 2, 3, 4]
94 94 |     result = [1, 2]
95    |-    async for i in items:
96    |-        result.append(i)  # PERF401
   95 |+    result.extend([i async for i in items])  # PERF401
97 96 | 
98 97 | 
99 98 | def f():

PERF401.py:102:9: PERF401 [*] Use `list.extend` to create a transformed list
    |
100 |     result, _ = [1, 2, 3, 4], ...
101 |     for i in range(10):
102 |         result.append(i * 2)  # PERF401
    |         ^^^^^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list.extend

ℹ Unsafe fix
98  98  | 
99  99  | def f():
100 100 |     result, _ = [1, 2, 3, 4], ...
101     |-    for i in range(10):
102     |-        result.append(i * 2)  # PERF401
    101 |+    result.extend(i * 2 for i in range(10))  # PERF401
103 102 | 
104 103 | 
105 104 | def f():

PERF401.py:111:17: PERF401 [*] Use `list.extend` to create a transformed list
    |
109 |             # single-line comment 2 should be protected
110 |             if i % 2:  # single-line comment 3 should be protected
111 |                 result.append(i)  # PERF401
    |                 ^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list.extend

ℹ Unsafe fix
105 105 | def f():
106 106 |     result = []
107 107 |     if True:
108     |-        for i in range(10):  # single-line comment 1 should be protected
109     |-            # single-line comment 2 should be protected
110     |-            if i % 2:  # single-line comment 3 should be protected
111     |-                result.append(i)  # PERF401
    108 |+        # single-line comment 1 should be protected
    109 |+        # single-line comment 2 should be protected
    110 |+        # single-line comment 3 should be protected
    111 |+        result.extend(i for i in range(10) if i % 2)  # PERF401
112 112 | 
113 113 | 
114 114 | def f():

PERF401.py:119:13: PERF401 [*] Use a list comprehension to create a transformed list
    |
117 |         # single-line comment 2 should be protected
118 |         if i % 2:  # single-line comment 3 should be protected
119 |             result.append(i)  # PERF401
    |             ^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
112 112 | 
113 113 | 
114 114 | def f():
115     |-    result = []  # comment after assignment should be protected
116     |-    for i in range(10):  # single-line comment 1 should be protected
117     |-        # single-line comment 2 should be protected
118     |-        if i % 2:  # single-line comment 3 should be protected
119     |-            result.append(i)  # PERF401
    115 |+    # comment after assignment should be protected
    116 |+    # single-line comment 1 should be protected
    117 |+    # single-line comment 2 should be protected
    118 |+    # single-line comment 3 should be protected
    119 |+    result = [i for i in range(10) if i % 2]  # PERF401
120 120 | 
121 121 | 
122 122 | def f():

PERF401.py:135:13: PERF401 [*] Use a list comprehension to create a transformed list
    |
133 |         new_layers = []
134 |         for value in param:
135 |             new_layers.append(value * 3)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
130 130 |     # PERF401
131 131 |     # make sure the fix does not panic if there is no comments
132 132 |     if param:
133     |-        new_layers = []
134     |-        for value in param:
135     |-            new_layers.append(value * 3)
    133 |+        new_layers = [value * 3 for value in param]
136 134 | 
137 135 | 
138 136 | def f():

PERF401.py:142:9: PERF401 [*] Use a list comprehension to create a transformed list
    |
140 |     var = 1
141 |     for _ in range(10):
142 |         result.append(var + 1)  # PERF401
    |         ^^^^^^^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
136 136 | 
137 137 | 
138 138 | def f():
139     |-    result = []
140 139 |     var = 1
141     |-    for _ in range(10):
142     |-        result.append(var + 1)  # PERF401
    140 |+    result = [var + 1 for _ in range(10)]  # PERF401
143 141 | 
144 142 | 
145 143 | def f():

PERF401.py:150:9: PERF401 [*] Use a list comprehension to create a transformed list
    |
148 |     result = []  # commment should be protected
149 |     for i in range(10):
150 |         result.append(i + 1)  # PERF401
    |         ^^^^^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
145 145 | def f():
146 146 |     # make sure that `tmp` is not deleted
147 147 |     tmp = 1
148     |-    result = []  # commment should be protected
149     |-    for i in range(10):
150     |-        result.append(i + 1)  # PERF401
    148 |+    # commment should be protected
    149 |+    result = [i + 1 for i in range(10)]  # PERF401
151 150 | 
152 151 | 
153 152 | def f():

PERF401.py:158:9: PERF401 [*] Use a list comprehension to create a transformed list
    |
156 |     tmp = 1  # commment should be protected
157 |     for i in range(10):
158 |         result.append(i + 1)  # PERF401
    |         ^^^^^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
152 152 | 
153 153 | def f():
154 154 |     # make sure that `tmp` is not deleted
155     |-    result = []
156 155 |     tmp = 1  # commment should be protected
157     |-    for i in range(10):
158     |-        result.append(i + 1)  # PERF401
    156 |+    result = [i + 1 for i in range(10)]  # PERF401
159 157 | 
160 158 | 
161 159 | def f():

PERF401.py:164:9: PERF401 [*] Use a list comprehension to create a transformed list
    |
162 |     result = []  # comment should be protected
163 |     for i in range(10):
164 |         result.append(i * 2)  # PERF401
    |         ^^^^^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
159 159 | 
160 160 | 
161 161 | def f():
162     |-    result = []  # comment should be protected
163     |-    for i in range(10):
164     |-        result.append(i * 2)  # PERF401
    162 |+    # comment should be protected
    163 |+    result = [i * 2 for i in range(10)]  # PERF401
165 164 | 
166 165 | 
167 166 | def f():

PERF401.py:171:9: PERF401 [*] Use `list.extend` to create a transformed list
    |
169 |     result.append(1)
170 |     for i in range(10):
171 |         result.append(i * 2)  # PERF401
    |         ^^^^^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list.extend

ℹ Unsafe fix
167 167 | def f():
168 168 |     result = []
169 169 |     result.append(1)
170     |-    for i in range(10):
171     |-        result.append(i * 2)  # PERF401
    170 |+    result.extend(i * 2 for i in range(10))  # PERF401
172 171 | 
173 172 | 
174 173 | def f():

PERF401.py:184:9: PERF401 [*] Use a list comprehension to create a transformed list
    |
182 |     result = []
183 |     for val in range(5):
184 |         result.append(val * 2)  # Ok
    |         ^^^^^^^^^^^^^^^^^^^^^^ PERF401
185 |     print(val)
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
179 179 | 
180 180 | 
181 181 | def f():
182     |-    result = []
183     |-    for val in range(5):
184     |-        result.append(val * 2)  # Ok
    182 |+    result = [val * 2 for val in range(5)]  # Ok
185 183 |     print(val)
186 184 | 
187 185 | 

PERF401.py:197:13: PERF401 [*] Use a list comprehension to create a transformed list
    |
195 |       ):  # Comment 3
196 |           if i % 2:  # Comment 4
197 |               result.append(
    |  _____________^
198 | |                 (
199 | |                     i + 1,
200 | |                     # Comment 5
201 | |                     2,
202 | |                 )
203 | |             )  # PERF401
    | |_____________^ PERF401
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
186 186 | 
187 187 | 
188 188 | def f():
189     |-    result = []
190     |-    for i in range(  # Comment 1 should not be duplicated
    189 |+    # Comment 3
    190 |+    # Comment 4
    191 |+    result = [(
    192 |+                    i + 1,
    193 |+                    # Comment 5
    194 |+                    2,
    195 |+                ) for i in range(  # Comment 1 should not be duplicated
191 196 |         (
192 197 |             2  # Comment 2
193 198 |             + 1
194 199 |         )
195     |-    ):  # Comment 3
196     |-        if i % 2:  # Comment 4
197     |-            result.append(
198     |-                (
199     |-                    i + 1,
200     |-                    # Comment 5
201     |-                    2,
202     |-                )
203     |-            )  # PERF401
    200 |+    ) if i % 2]  # PERF401
204 201 | 
205 202 | 
206 203 | def f():

PERF401.py:209:9: PERF401 [*] Use a list comprehension to create a transformed list
    |
207 |     result: list[int] = []
208 |     for i in range(10):
209 |         result.append(i * 2)  # PERF401
    |         ^^^^^^^^^^^^^^^^^^^^ PERF401
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
204 204 | 
205 205 | 
206 206 | def f():
207     |-    result: list[int] = []
208     |-    for i in range(10):
209     |-        result.append(i * 2)  # PERF401
    207 |+    result: list[int] = [i * 2 for i in range(10)]  # PERF401
210 208 | 
211 209 | 
212 210 | def f():

PERF401.py:216:9: PERF401 [*] Use a list comprehension to create a transformed list
    |
214 |     result = []
215 |     for i in a, b:
216 |         result.append(i[0] + i[1])  # PERF401
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^ PERF401
217 |     return result
    |
    = help: Replace for loop with list comprehension

ℹ Unsafe fix
211 211 | 
212 212 | def f():
213 213 |     a, b = [1, 2, 3], [4, 5, 6]
214     |-    result = []
215     |-    for i in a, b:
216     |-        result.append(i[0] + i[1])  # PERF401
    214 |+    result = [i[0] + i[1] for i in (a, b)]  # PERF401
217 215 |     return result
