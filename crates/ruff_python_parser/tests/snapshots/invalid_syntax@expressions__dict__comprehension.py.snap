---
source: crates/ruff_python_parser/tests/fixtures.rs
input_file: crates/ruff_python_parser/resources/invalid/expressions/dict/comprehension.py
---
## AST

```
Module(
    ModModule {
        node_index: AtomicNodeIndex(..),
        range: 0..362,
        body: [
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 17..34,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 17..34,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 18..19,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 21..22,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 23..33,
                                    node_index: AtomicNodeIndex(..),
                                    target: NumberLiteral(
                                        ExprNumberLiteral {
                                            node_index: AtomicNodeIndex(..),
                                            range: 27..28,
                                            value: Int(
                                                1,
                                            ),
                                        },
                                    ),
                                    iter: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 32..33,
                                            id: Name("y"),
                                            ctx: Load,
                                        },
                                    ),
                                    ifs: [],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 35..54,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 35..54,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 36..37,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 39..40,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 41..53,
                                    node_index: AtomicNodeIndex(..),
                                    target: StringLiteral(
                                        ExprStringLiteral {
                                            node_index: AtomicNodeIndex(..),
                                            range: 45..48,
                                            value: StringLiteralValue {
                                                inner: Single(
                                                    StringLiteral {
                                                        range: 45..48,
                                                        node_index: AtomicNodeIndex(..),
                                                        value: "a",
                                                        flags: StringLiteralFlags {
                                                            quote_style: Single,
                                                            prefix: Empty,
                                                            triple_quoted: false,
                                                        },
                                                    },
                                                ),
                                            },
                                        },
                                    ),
                                    iter: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 52..53,
                                            id: Name("y"),
                                            ctx: Load,
                                        },
                                    ),
                                    ifs: [],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 55..77,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 55..77,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 56..57,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 59..60,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 61..76,
                                    node_index: AtomicNodeIndex(..),
                                    target: Call(
                                        ExprCall {
                                            node_index: AtomicNodeIndex(..),
                                            range: 65..71,
                                            func: Name(
                                                ExprName {
                                                    node_index: AtomicNodeIndex(..),
                                                    range: 65..69,
                                                    id: Name("call"),
                                                    ctx: Load,
                                                },
                                            ),
                                            arguments: Arguments {
                                                range: 69..71,
                                                node_index: AtomicNodeIndex(..),
                                                args: [],
                                                keywords: [],
                                            },
                                        },
                                    ),
                                    iter: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 75..76,
                                            id: Name("y"),
                                            ctx: Load,
                                        },
                                    ),
                                    ifs: [],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 78..100,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 78..100,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 79..80,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 82..83,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 84..99,
                                    node_index: AtomicNodeIndex(..),
                                    target: Set(
                                        ExprSet {
                                            node_index: AtomicNodeIndex(..),
                                            range: 88..94,
                                            elts: [
                                                Name(
                                                    ExprName {
                                                        node_index: AtomicNodeIndex(..),
                                                        range: 89..90,
                                                        id: Name("a"),
                                                        ctx: Load,
                                                    },
                                                ),
                                                Name(
                                                    ExprName {
                                                        node_index: AtomicNodeIndex(..),
                                                        range: 92..93,
                                                        id: Name("b"),
                                                        ctx: Load,
                                                    },
                                                ),
                                            ],
                                        },
                                    ),
                                    iter: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 98..99,
                                            id: Name("y"),
                                            ctx: Load,
                                        },
                                    ),
                                    ifs: [],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 117..135,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 117..135,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 118..119,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 121..122,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 123..134,
                                    node_index: AtomicNodeIndex(..),
                                    target: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 127..128,
                                            id: Name("x"),
                                            ctx: Store,
                                        },
                                    ),
                                    iter: Starred(
                                        ExprStarred {
                                            node_index: AtomicNodeIndex(..),
                                            range: 132..134,
                                            value: Name(
                                                ExprName {
                                                    node_index: AtomicNodeIndex(..),
                                                    range: 133..134,
                                                    id: Name("y"),
                                                    ctx: Load,
                                                },
                                            ),
                                            ctx: Load,
                                        },
                                    ),
                                    ifs: [],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 136..159,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 136..159,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 137..138,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 140..141,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 142..158,
                                    node_index: AtomicNodeIndex(..),
                                    target: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 146..147,
                                            id: Name("x"),
                                            ctx: Store,
                                        },
                                    ),
                                    iter: Yield(
                                        ExprYield {
                                            node_index: AtomicNodeIndex(..),
                                            range: 151..158,
                                            value: Some(
                                                Name(
                                                    ExprName {
                                                        node_index: AtomicNodeIndex(..),
                                                        range: 157..158,
                                                        id: Name("y"),
                                                        ctx: Load,
                                                    },
                                                ),
                                            ),
                                        },
                                    ),
                                    ifs: [],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 160..188,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 160..188,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 161..162,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 164..165,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 166..187,
                                    node_index: AtomicNodeIndex(..),
                                    target: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 170..171,
                                            id: Name("x"),
                                            ctx: Store,
                                        },
                                    ),
                                    iter: YieldFrom(
                                        ExprYieldFrom {
                                            node_index: AtomicNodeIndex(..),
                                            range: 175..187,
                                            value: Name(
                                                ExprName {
                                                    node_index: AtomicNodeIndex(..),
                                                    range: 186..187,
                                                    id: Name("y"),
                                                    ctx: Load,
                                                },
                                            ),
                                        },
                                    ),
                                    ifs: [],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 189..216,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 189..216,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 190..191,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 193..194,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 195..215,
                                    node_index: AtomicNodeIndex(..),
                                    target: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 199..200,
                                            id: Name("x"),
                                            ctx: Store,
                                        },
                                    ),
                                    iter: Lambda(
                                        ExprLambda {
                                            node_index: AtomicNodeIndex(..),
                                            range: 204..215,
                                            parameters: Some(
                                                Parameters {
                                                    range: 211..212,
                                                    node_index: AtomicNodeIndex(
                                                        0,
                                                    ),
                                                    posonlyargs: [],
                                                    args: [
                                                        ParameterWithDefault {
                                                            range: 211..212,
                                                            node_index: AtomicNodeIndex(..),
                                                            parameter: Parameter {
                                                                range: 211..212,
                                                                node_index: AtomicNodeIndex(..),
                                                                name: Identifier {
                                                                    id: Name("y"),
                                                                    range: 211..212,
                                                                    node_index: AtomicNodeIndex(..),
                                                                },
                                                                annotation: None,
                                                            },
                                                            default: None,
                                                        },
                                                    ],
                                                    vararg: None,
                                                    kwonlyargs: [],
                                                    kwarg: None,
                                                },
                                            ),
                                            body: Name(
                                                ExprName {
                                                    node_index: AtomicNodeIndex(..),
                                                    range: 214..215,
                                                    id: Name("y"),
                                                    ctx: Load,
                                                },
                                            ),
                                        },
                                    ),
                                    ifs: [],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 231..257,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 231..257,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 232..233,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 235..236,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 237..256,
                                    node_index: AtomicNodeIndex(..),
                                    target: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 241..242,
                                            id: Name("x"),
                                            ctx: Store,
                                        },
                                    ),
                                    iter: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 246..250,
                                            id: Name("data"),
                                            ctx: Load,
                                        },
                                    ),
                                    ifs: [
                                        Starred(
                                            ExprStarred {
                                                node_index: AtomicNodeIndex(..),
                                                range: 254..256,
                                                value: Name(
                                                    ExprName {
                                                        node_index: AtomicNodeIndex(..),
                                                        range: 255..256,
                                                        id: Name("y"),
                                                        ctx: Load,
                                                    },
                                                ),
                                                ctx: Load,
                                            },
                                        ),
                                    ],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 258..289,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 258..289,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 259..260,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 262..263,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 264..288,
                                    node_index: AtomicNodeIndex(..),
                                    target: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 268..269,
                                            id: Name("x"),
                                            ctx: Store,
                                        },
                                    ),
                                    iter: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 273..277,
                                            id: Name("data"),
                                            ctx: Load,
                                        },
                                    ),
                                    ifs: [
                                        Yield(
                                            ExprYield {
                                                node_index: AtomicNodeIndex(..),
                                                range: 281..288,
                                                value: Some(
                                                    Name(
                                                        ExprName {
                                                            node_index: AtomicNodeIndex(..),
                                                            range: 287..288,
                                                            id: Name("y"),
                                                            ctx: Load,
                                                        },
                                                    ),
                                                ),
                                            },
                                        ),
                                    ],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 290..326,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 290..326,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 291..292,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 294..295,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 296..325,
                                    node_index: AtomicNodeIndex(..),
                                    target: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 300..301,
                                            id: Name("x"),
                                            ctx: Store,
                                        },
                                    ),
                                    iter: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 305..309,
                                            id: Name("data"),
                                            ctx: Load,
                                        },
                                    ),
                                    ifs: [
                                        YieldFrom(
                                            ExprYieldFrom {
                                                node_index: AtomicNodeIndex(..),
                                                range: 313..325,
                                                value: Name(
                                                    ExprName {
                                                        node_index: AtomicNodeIndex(..),
                                                        range: 324..325,
                                                        id: Name("y"),
                                                        ctx: Load,
                                                    },
                                                ),
                                            },
                                        ),
                                    ],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
            Expr(
                StmtExpr {
                    node_index: AtomicNodeIndex(..),
                    range: 327..362,
                    value: DictComp(
                        ExprDictComp {
                            node_index: AtomicNodeIndex(..),
                            range: 327..362,
                            key: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 328..329,
                                    id: Name("x"),
                                    ctx: Load,
                                },
                            ),
                            value: Name(
                                ExprName {
                                    node_index: AtomicNodeIndex(..),
                                    range: 331..332,
                                    id: Name("y"),
                                    ctx: Load,
                                },
                            ),
                            generators: [
                                Comprehension {
                                    range: 333..361,
                                    node_index: AtomicNodeIndex(..),
                                    target: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 337..338,
                                            id: Name("x"),
                                            ctx: Store,
                                        },
                                    ),
                                    iter: Name(
                                        ExprName {
                                            node_index: AtomicNodeIndex(..),
                                            range: 342..346,
                                            id: Name("data"),
                                            ctx: Load,
                                        },
                                    ),
                                    ifs: [
                                        Lambda(
                                            ExprLambda {
                                                node_index: AtomicNodeIndex(..),
                                                range: 350..361,
                                                parameters: Some(
                                                    Parameters {
                                                        range: 357..358,
                                                        node_index: AtomicNodeIndex(
                                                            0,
                                                        ),
                                                        posonlyargs: [],
                                                        args: [
                                                            ParameterWithDefault {
                                                                range: 357..358,
                                                                node_index: AtomicNodeIndex(..),
                                                                parameter: Parameter {
                                                                    range: 357..358,
                                                                    node_index: AtomicNodeIndex(..),
                                                                    name: Identifier {
                                                                        id: Name("y"),
                                                                        range: 357..358,
                                                                        node_index: AtomicNodeIndex(..),
                                                                    },
                                                                    annotation: None,
                                                                },
                                                                default: None,
                                                            },
                                                        ],
                                                        vararg: None,
                                                        kwonlyargs: [],
                                                        kwarg: None,
                                                    },
                                                ),
                                                body: Name(
                                                    ExprName {
                                                        node_index: AtomicNodeIndex(..),
                                                        range: 360..361,
                                                        id: Name("y"),
                                                        ctx: Load,
                                                    },
                                                ),
                                            },
                                        ),
                                    ],
                                    is_async: false,
                                },
                            ],
                        },
                    ),
                },
            ),
        ],
    },
)
```
## Errors

  |
1 | # Invalid target
2 | {x: y for 1 in y}
  |           ^ Syntax Error: Invalid assignment target
3 | {x: y for 'a' in y}
4 | {x: y for call() in y}
  |


  |
1 | # Invalid target
2 | {x: y for 1 in y}
3 | {x: y for 'a' in y}
  |           ^^^ Syntax Error: Invalid assignment target
4 | {x: y for call() in y}
5 | {x: y for {a, b} in y}
  |


  |
2 | {x: y for 1 in y}
3 | {x: y for 'a' in y}
4 | {x: y for call() in y}
  |           ^^^^^^ Syntax Error: Invalid assignment target
5 | {x: y for {a, b} in y}
  |


  |
3 | {x: y for 'a' in y}
4 | {x: y for call() in y}
5 | {x: y for {a, b} in y}
  |           ^^^^^^ Syntax Error: Invalid assignment target
6 |
7 | # Invalid iter
  |


   |
 7 | # Invalid iter
 8 | {x: y for x in *y}
   |                ^^ Syntax Error: Starred expression cannot be used here
 9 | {x: y for x in yield y}
10 | {x: y for x in yield from y}
   |


   |
 7 | # Invalid iter
 8 | {x: y for x in *y}
 9 | {x: y for x in yield y}
   |                ^^^^^^^ Syntax Error: Yield expression cannot be used here
10 | {x: y for x in yield from y}
11 | {x: y for x in lambda y: y}
   |


   |
 8 | {x: y for x in *y}
 9 | {x: y for x in yield y}
10 | {x: y for x in yield from y}
   |                ^^^^^^^^^^^^ Syntax Error: Yield expression cannot be used here
11 | {x: y for x in lambda y: y}
   |


   |
 9 | {x: y for x in yield y}
10 | {x: y for x in yield from y}
11 | {x: y for x in lambda y: y}
   |                ^^^^^^^^^^^ Syntax Error: Lambda expression cannot be used here
12 |
13 | # Invalid if
   |


   |
13 | # Invalid if
14 | {x: y for x in data if *y}
   |                        ^^ Syntax Error: Starred expression cannot be used here
15 | {x: y for x in data if yield y}
16 | {x: y for x in data if yield from y}
   |


   |
13 | # Invalid if
14 | {x: y for x in data if *y}
15 | {x: y for x in data if yield y}
   |                        ^^^^^^^ Syntax Error: Yield expression cannot be used here
16 | {x: y for x in data if yield from y}
17 | {x: y for x in data if lambda y: y}
   |


   |
14 | {x: y for x in data if *y}
15 | {x: y for x in data if yield y}
16 | {x: y for x in data if yield from y}
   |                        ^^^^^^^^^^^^ Syntax Error: Yield expression cannot be used here
17 | {x: y for x in data if lambda y: y}
   |


   |
15 | {x: y for x in data if yield y}
16 | {x: y for x in data if yield from y}
17 | {x: y for x in data if lambda y: y}
   |                        ^^^^^^^^^^^ Syntax Error: Lambda expression cannot be used here
   |
